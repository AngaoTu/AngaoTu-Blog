[toc]

# OC底层原理-多线程

## 基本概念

### 进程与线程定义

- 进程：
  - 进程是指在系统中正在运行的一个应用程序;
  - 每个进程之间是独立的，每个进程均运行在其专用的且受保护的内存空间内;
- 线程：
  - 线程是进程的基本执行单元，一个进程的所有任务都在线程中执行;
  - 进程要想执行任务，必须得有线程，进程至少要有一条线程;
  - 程序启动会默认开启一条线程，这条线程被称为**主线程**;

### 进程与线程关系

- 地址空间: 同一**进程**内的**线程**共享本进程的地址空间，而进程之间则是独立的地址空间。

- 资源拥有: 同一**进程**内的**线程**共享本进程的资源(如内存、I/O、CPU等)，而进程之间的资源则是独立的。
- 一个进程崩溃后，在保护模式下不会对其他进程产生影响，但是一个线程崩溃，整个进程都会死掉。
- 进程切换时，消耗的资源大，效率高。所以涉及到频繁的切换时，使用线程要好于进程

### 多线程

- 在一个进程中可以开辟多条线程，多条线程可以并发执行不同的任务，多条线程并发执行。在单核情况下，其实是`CPU`快速的在多条线程之间调度，`CPU`的执行很快，调度的时间足够快就会造成多线程同时执行的假象。如果是多核，才可以真正做到并发。
- 优点
  - 能提高程序的执行效率
  - 能提高资源利用率（`CPU`、内存利用率）
- 缺点
  - 开启线程需要占用一定的空间（默认情况下主线程占1M，子线程占512KB），如果开启大量的线程，就会占用大量的内存空间，降低了程序的性能
  - 线程越多，`CPU`花在调度线程上的开销也就越大
  - 程序设计更复杂，比如线程通信，线程安全等

